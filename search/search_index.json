{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Catalyst Build Executor (CBE)","text":"<p><code>cbe</code> is a high-speed, low-level build orchestrator designed as a machine-generated target for higher-level meta-build systems (with a first-class support for catalyst) enabling high speed incremental builds.</p>"},{"location":"#table-of-contents","title":"Table of Contents","text":"<ol> <li>CLI Reference</li> <li>Buildfile Format</li> <li>Internals &amp; Implementation</li> </ol>"},{"location":"cli/reference/","title":"CLI Reference","text":"<p>The <code>cbe</code> executable provides a set of cli flags to modulate behavior.</p>"},{"location":"cli/reference/#synopsis","title":"Synopsis","text":"<pre><code>cbe [options]\n</code></pre>"},{"location":"cli/reference/#options","title":"Options","text":"Option Description Defaults <code>-h, --help</code> Show the help message and exit. N/A <code>-v, --version</code> Show the version information and exit. N/A <code>-d &lt;dir&gt;</code> Change the working directory before performing any operations. Current Working Directory <code>-f &lt;file&gt;</code> Use <code>&lt;file&gt;</code> as the build manifest. <code>catalyst.build</code>. <code>-j, --jobs &lt;N&gt;</code> Set the number of parallel jobs. Maximum number of available hardware threads (<code>nproc</code>). <code>--dry-run</code> Print the commands that would be executed without actually running them. N/A <code>--clean</code> Remove all generated build artifacts defined in the manifest (including sidecar <code>.d</code> files). N/A <code>--compdb</code> Generate a <code>compile_commands.json</code> file for integration with clangd and other IDEs. N/A"},{"location":"concepts/manifest/","title":"Build File Schema","text":"<p>The <code>catalyst.build</code> manifest defines the build graphs and arguments for build rules. It uses a strict, pipe-delimited, 3-column format designed for efficient parsing.</p>"},{"location":"concepts/manifest/#structure","title":"Structure","text":"<p>The file can have either of: Definitions or Build Steps.</p>"},{"location":"concepts/manifest/#definitions","title":"Definitions","text":"<p>Definitions configure the toolchain and environment variables.</p> <p>Format: <code>DEF|&lt;var&gt;|&lt;val&gt;</code></p> <ul> <li><code>DEF</code>: The introducer for a definition line. Must be capitalized.</li> <li><code>&lt;var&gt;</code>: The variable name (e.g., <code>cc</code>, <code>cflags</code>).</li> <li><code>&lt;val&gt;</code>: The value assigned to the variable. Empty values use <code>DEF|&lt;var&gt;|</code>.</li> </ul>"},{"location":"concepts/manifest/#supported-variables","title":"Supported Variables","text":"Variable Description Example <code>cc</code> The C compiler executable. <code>/usr/bin/clang</code> <code>cxx</code> The C++ compiler executable. <code>/usr/bin/clang++</code> <code>cflags</code> Flags passed to <code>cc</code> steps. <code>-O2 -Wall</code> <code>cxxflags</code> Flags passed to <code>cxx</code> steps. <code>-std=c++20 -O3</code> <code>ldflags</code> Linker search paths and general flags. <code>-L/usr/local/lib</code> <code>ldlibs</code> Libraries to link against. <code>-lpthread -lm</code>"},{"location":"concepts/manifest/#build-steps","title":"Build Steps","text":"<p>Build steps define the actions to transform input files into output files.</p> <p>Format: <code>&lt;step_type&gt;|&lt;input_list&gt;|&lt;output_file&gt;</code></p> <ul> <li><code>&lt;step_type&gt;</code>: Mnemonic for the tool to use (see Toolchain Mapping).</li> <li><code>&lt;input_list&gt;</code>: Comma-separated list of input files.</li> <li><code>&lt;output_file&gt;</code>: The path to the generated file.</li> </ul>"},{"location":"concepts/manifest/#toolchain-mapping","title":"Toolchain Mapping","text":"<p>CBE maps specific step types to command templates. It strictly enforces certain behaviors (like dependency generation) by injecting flags.</p> Type Description Command Template (Approximation) <code>cc</code> C Compile <code>$cc $cflags -MMD -MF $out.d -c $in -o $out</code> <code>cxx</code> C++ Compile <code>$cxx $cxxflags -MMD -MF $out.d -c $in -o $out</code> <code>ld</code> Binary Link <code>$cxx $in -o $out $ldflags $ldlibs</code> <code>ar</code> Static Link <code>ar rcs $out $in</code> <code>sld</code> Shared Link <code>$cxx -shared $in -o $out</code> <p>Important Notes(See Implementation Details for more info):</p> <ol> <li>Dependency Tracking (<code>.d</code>): For <code>cc</code> and <code>cxx</code>, do not manually add <code>-MMD</code> or <code>-MF</code> to your <code>$cflags</code>/<code>$cxxflags</code>. CBE automatically injects these to manage incremental builds correctly.</li> <li>Response Files (<code>.rsp</code>): For <code>ld</code> steps with many inputs (currently &gt;50), CBE will automatically generate a response file and pass it via <code>@&lt;out&gt;.rsp</code> to avoid command-line length limits.</li> </ol>"},{"location":"concepts/manifest/#example-manifest","title":"Example Manifest","text":"<pre><code>DEF|cc|clang\nDEF|cxx|clang++\nDEF|cflags|\nDEF|cxxflags|-std=c++20 -O3\nDEF|ldflags|\nDEF|ldlibs|\ncxx|src/main.cpp|build/main.o\ncxx|src/net.cpp|build/net.o\nld|build/main.o,build/net.o|build/app\n</code></pre>"},{"location":"implementation/overview/","title":"Implementation Details","text":""},{"location":"implementation/overview/#core-architecture","title":"Core Architecture","text":"<p>CBE operates in three phases:</p> <ol> <li>Parsing: The <code>catalyst.build</code> manifest is parsed into a linear sequence of definitions and steps.</li> <li>Graph Construction: A buildgraph is built. This is where implicit dependencies are discovered and cycles are found.</li> <li>Execution: The graph is traversed, and tasks are scheduled onto a thread pool.</li> </ol>"},{"location":"implementation/overview/#dependency-tracking-d-files","title":"Dependency Tracking (<code>.d</code> Files)","text":"<p>CBE tracks implicit dependencies, such as files included by <code>#include</code> <code>/#include_next</code>.</p>"},{"location":"implementation/overview/#how-it-works","title":"How it works","text":"<ol> <li>Injection: When executing a <code>cc</code> or <code>cxx</code> step, CBE passes in the <code>-MMD -MF &lt;output&gt;.d</code> flags to the compiler. This instructs the compiler (GCC/Clang) to emit a Make-compatible dependency file alongside the object file for the next build.</li> <li>Discovery: On the next pass, during graph construction, CBE checks for the existence of these <code>.d</code> files from the previous build.</li> <li>Parsing: CBE reads the <code>.d</code> file and extracts every input into the build graph.</li> <li>Graph augmentation: These discovered prerequisites are added as nodes in the build graph, with edges pointing to the object file.</li> </ol>"},{"location":"implementation/overview/#staleness-check","title":"Staleness Check","text":"<p>During execution, CBE checks the modification time of: -  Source input files. -  The output object file. -  Dependencies discovered from the <code>.d</code> file.</p> <p>If any dependency is newer than the object file, the step is re-executed.</p>"},{"location":"implementation/overview/#automatic-response-files-rsp","title":"Automatic Response Files (<code>.rsp</code>)","text":"<p>To overcome operating system limits on command-line length (which can be exceeded when linking large projects), CBE implements automatic response file generation.</p>"},{"location":"implementation/overview/#the-mechanism","title":"The Mechanism","text":"<p>For the <code>ld</code> (Link) step:</p> <ol> <li>Threshold Check: CBE checks the number of input files. The current internal threshold is 50 inputs.</li> <li>Generation: If the number of inputs exceeds this threshold, CBE generates a temporary file named <code>&lt;output&gt;.rsp</code>.</li> <li>Content: This file contains the list of all input files, separated by newlines.</li> <li>Command Mutation: The command line is altered. Instead of passing <code>obj1.o obj2.o ...</code>, CBE passes <code>@&lt;output&gt;.rsp</code>. The linker (<code>ld/link.exe/etc.</code>) reads the arguments from this file.</li> </ol> <p>This process ensures builds don't fail due to command line limits.</p>"},{"location":"implementation/overview/#performance-optimizations","title":"Performance Optimizations","text":""},{"location":"implementation/overview/#memory-mapped-io","title":"Memory Mapped I/O","text":"<p>CBE extensively uses <code>mmap</code> (on Linux/macOS) or <code>CreateFileMapping</code> (on Windows) for reading source files and dependency files. This reduces the number of system calls and allows the OS to manage page caching efficiently.</p>"},{"location":"implementation/overview/#thread-pool","title":"Thread Pool","text":"<p>A thread pool consumes tasks from a ready-queue. This queue is populated by a topological sort of the build graph.</p>"},{"location":"implementation/overview/#stat-caching","title":"Stat Caching","text":"<p>CBE populates a stat cache to ensure that \"popular\" dependencies don't invoke unnecesary stat syscalls.</p>"}]}